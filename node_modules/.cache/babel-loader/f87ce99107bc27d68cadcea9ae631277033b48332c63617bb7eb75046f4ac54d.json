{"ast":null,"code":"import { ROUTE_ABANDONED_PAGE, ROUTE_ERROR_PAGE, ROUTE_SUCCESS_PAGE } from \"../Routes/RouteMapping\";\nimport { CONNECTION_ABANDONED, CONNECTION_ERROR, CONNECTION_SUCCESS, STORAGE_CONNECTION_STATE, STORAGE_WORK_PLATFORM_ID } from \"./constants\";\nexport const launchSDK = async (setLoader, navigate, id) => {\n  setLoader(true);\n  try {\n    const environment = \"dev\";\n    const clientDisplayName = \"Demo-app\";\n    let workPlatformId;\n    //clear connection state\n    sessionStorage.removeItem(STORAGE_CONNECTION_STATE);\n\n    // if id not passed get from storage\n    if (id === undefined) {\n      workPlatformId = sessionStorage.getItem(STORAGE_WORK_PLATFORM_ID) !== \"undefined\" && sessionStorage.getItem(STORAGE_WORK_PLATFORM_ID) !== \"null\" ? sessionStorage.getItem(STORAGE_WORK_PLATFORM_ID) : null;\n    } else {\n      workPlatformId = id;\n    }\n    const userId = \"ee220e94-8536-4c50-bff3-dca11a45a250\";\n    let token = \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiZWUyMjBlOTQtODUzNi00YzUwLWJmZjMtZGNhMTFhNDVhMjUwIiwidGVuYW50X2lkIjoiNGMxMzJkNDAtMjE0OC00OWQyLWJiOGQtY2FlNTU4NzNhNjlkIiwidGVuYW50X2FwcF9pZCI6IjNjMTMyZDQwLTIxNDgtNDlkMi1iYjhkLWNhZTU1ODczYTY5ZCIsInByb2R1Y3RzIjpbIklERU5USVRZIiwiRU5HQUdFTUVOVCJdLCJpc3MiOiJodHRwczovL2FwaS5kZXYuZ2V0cGh5bGxvLmNvbSIsImF1ZCI6Imh0dHBzOi8vYXBpLmRldi5nZXRwaHlsbG8uY29tL3YxL2ludGVybmFsIiwiaWF0IjoxNjc1NjY4OTc3LjE5NTU3MiwiZXhwIjoxNjc2MjczNzc3LjE5NTU1OH0.ROXfWegA4Jq0Vg6pQH-qr7JSZ7MFxYEwe-QKl0gIA8g\";\n\n    //   if (!userId || !token) {\n    //     const timeStamp = new Date();\n    //     const userId = await createUser(clientDisplayName, timeStamp.getTime());\n\n    //     const token = await createUserToken(userId);\n    //     sessionStorage.setItem(\"PhylloUserId\", userId);\n    //     sessionStorage.setItem(\"PhylloToken\", token);\n    //   }\n    // const phylloConnectURL = await window.PhylloConnectSDK.clientConnect(\n    //   env,\n    //   userId,\n    //   token,\n    //   name,\n    //   workPlatformId\n    // );\n    // window.location.href = phylloConnectURL;\n    // debugger\n    const config = {\n      clientDisplayName,\n      environment,\n      userId,\n      token,\n      redirect: false,\n      workPlatformId\n    };\n    const onExitCallBack = (reason, userId) => {\n      console.log(`onExit reason: ${reason}, userId: ${userId}`);\n      //check state\n      const state = sessionStorage.getItem(STORAGE_CONNECTION_STATE);\n      if (state === CONNECTION_SUCCESS) {\n        navigate(ROUTE_SUCCESS_PAGE);\n        setLoader(false);\n        return;\n      } else if (state === CONNECTION_ABANDONED) {\n        navigate(ROUTE_ABANDONED_PAGE);\n        setLoader(false);\n        return;\n      } else if (state === CONNECTION_ERROR) {\n        navigate(ROUTE_ERROR_PAGE);\n        setLoader(false);\n        return;\n      } else {\n        navigate(ROUTE_ABANDONED_PAGE);\n        setLoader(false);\n        return;\n      }\n      //   history.go(0);\n    };\n\n    const onAccountConnectedCallBack = (accountId, workplatformId, userId) => {\n      sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_SUCCESS);\n      console.log(`onAccountConnected accountId: ${accountId}, workplatformId: ${workplatformId}, userId: ${userId}`);\n    };\n    const onAccountDisconnectedCallBack = (accountId, workplatformId, userId) => {\n      console.log(`onAccountDisconnected accountId: ${accountId}, workplatformId: ${workplatformId}, userId: ${userId}`);\n    };\n    const onTokenExpiredCallBack = userId => {\n      console.log(`onTokenExpired userId: ${userId}`);\n    };\n    const onConnectionFailure = (reason, workplatformId, userId) => {\n      // if state not success\n      const state = sessionStorage.getItem(STORAGE_CONNECTION_STATE);\n      if (state === CONNECTION_SUCCESS) {\n        return;\n      }\n      if (reason === \"CONNECTION_ABANDONED\") {\n        sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_ABANDONED);\n      } else if (reason === \"INCORRECT_ACCOUNT_TYPE\" || reason === \"INADEQUATE_PERMISSIONS\") {\n        sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_ERROR);\n      } else {\n        sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_ERROR);\n      }\n      console.log(`onConnectionFailure: ${reason}, ${workplatformId}, ${userId}`);\n    };\n    const phylloConnect = window.PhylloConnect.initialize(config);\n    phylloConnect.on(\"exit\", onExitCallBack);\n    phylloConnect.on(\"tokenExpired\", onTokenExpiredCallBack);\n    phylloConnect.on(\"accountConnected\", onAccountConnectedCallBack);\n    phylloConnect.on(\"accountDisconnected\", onAccountDisconnectedCallBack);\n    phylloConnect.on(\"connectionFailure\", onConnectionFailure);\n    phylloConnect.open();\n  } catch (err) {\n    console.log(err);\n    setLoader(false);\n  }\n};","map":{"version":3,"names":["ROUTE_ABANDONED_PAGE","ROUTE_ERROR_PAGE","ROUTE_SUCCESS_PAGE","CONNECTION_ABANDONED","CONNECTION_ERROR","CONNECTION_SUCCESS","STORAGE_CONNECTION_STATE","STORAGE_WORK_PLATFORM_ID","launchSDK","setLoader","navigate","id","environment","clientDisplayName","workPlatformId","sessionStorage","removeItem","undefined","getItem","userId","token","config","redirect","onExitCallBack","reason","console","log","state","onAccountConnectedCallBack","accountId","workplatformId","setItem","onAccountDisconnectedCallBack","onTokenExpiredCallBack","onConnectionFailure","phylloConnect","window","PhylloConnect","initialize","on","open","err"],"sources":["/Users/rajeshbagul/code/connect-account-creator/src/utils/helpers.js"],"sourcesContent":["import {\n  ROUTE_ABANDONED_PAGE,\n  ROUTE_ERROR_PAGE,\n  ROUTE_SUCCESS_PAGE,\n} from \"../Routes/RouteMapping\";\nimport {\n  CONNECTION_ABANDONED,\n  CONNECTION_ERROR,\n  CONNECTION_SUCCESS,\n  STORAGE_CONNECTION_STATE,\n  STORAGE_WORK_PLATFORM_ID,\n} from \"./constants\";\n\nexport const launchSDK = async (setLoader, navigate, id) => {\n  setLoader(true);\n  try {\n    const environment = \"dev\";\n    const clientDisplayName = \"Demo-app\";\n    let workPlatformId;\n    //clear connection state\n    sessionStorage.removeItem(STORAGE_CONNECTION_STATE);\n\n    // if id not passed get from storage\n    if (id === undefined) {\n      workPlatformId =\n        sessionStorage.getItem(STORAGE_WORK_PLATFORM_ID) !== \"undefined\" &&\n        sessionStorage.getItem(STORAGE_WORK_PLATFORM_ID) !== \"null\"\n          ? sessionStorage.getItem(STORAGE_WORK_PLATFORM_ID)\n          : null;\n    } else {\n      workPlatformId = id;\n    }\n\n    const userId = \"ee220e94-8536-4c50-bff3-dca11a45a250\";\n    let token =\n      \"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiZWUyMjBlOTQtODUzNi00YzUwLWJmZjMtZGNhMTFhNDVhMjUwIiwidGVuYW50X2lkIjoiNGMxMzJkNDAtMjE0OC00OWQyLWJiOGQtY2FlNTU4NzNhNjlkIiwidGVuYW50X2FwcF9pZCI6IjNjMTMyZDQwLTIxNDgtNDlkMi1iYjhkLWNhZTU1ODczYTY5ZCIsInByb2R1Y3RzIjpbIklERU5USVRZIiwiRU5HQUdFTUVOVCJdLCJpc3MiOiJodHRwczovL2FwaS5kZXYuZ2V0cGh5bGxvLmNvbSIsImF1ZCI6Imh0dHBzOi8vYXBpLmRldi5nZXRwaHlsbG8uY29tL3YxL2ludGVybmFsIiwiaWF0IjoxNjc1NjY4OTc3LjE5NTU3MiwiZXhwIjoxNjc2MjczNzc3LjE5NTU1OH0.ROXfWegA4Jq0Vg6pQH-qr7JSZ7MFxYEwe-QKl0gIA8g\";\n\n    //   if (!userId || !token) {\n    //     const timeStamp = new Date();\n    //     const userId = await createUser(clientDisplayName, timeStamp.getTime());\n\n    //     const token = await createUserToken(userId);\n    //     sessionStorage.setItem(\"PhylloUserId\", userId);\n    //     sessionStorage.setItem(\"PhylloToken\", token);\n    //   }\n    // const phylloConnectURL = await window.PhylloConnectSDK.clientConnect(\n    //   env,\n    //   userId,\n    //   token,\n    //   name,\n    //   workPlatformId\n    // );\n    // window.location.href = phylloConnectURL;\n    // debugger\n    const config = {\n      clientDisplayName,\n      environment,\n      userId,\n      token,\n      redirect: false,\n      workPlatformId,\n    };\n\n    const onExitCallBack = (reason, userId) => {\n      console.log(`onExit reason: ${reason}, userId: ${userId}`);\n      //check state\n      const state = sessionStorage.getItem(STORAGE_CONNECTION_STATE);\n      if (state === CONNECTION_SUCCESS) {\n        navigate(ROUTE_SUCCESS_PAGE);\n        setLoader(false);\n        return;\n      } else if (state === CONNECTION_ABANDONED) {\n        navigate(ROUTE_ABANDONED_PAGE);\n        setLoader(false);\n        return;\n      } else if (state === CONNECTION_ERROR) {\n        navigate(ROUTE_ERROR_PAGE);\n        setLoader(false);\n        return;\n      } else {\n        navigate(ROUTE_ABANDONED_PAGE);\n        setLoader(false);\n        return;\n      }\n      //   history.go(0);\n    };\n\n    const onAccountConnectedCallBack = (accountId, workplatformId, userId) => {\n      sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_SUCCESS);\n      console.log(\n        `onAccountConnected accountId: ${accountId}, workplatformId: ${workplatformId}, userId: ${userId}`\n      );\n    };\n    const onAccountDisconnectedCallBack = (\n      accountId,\n      workplatformId,\n      userId\n    ) => {\n      console.log(\n        `onAccountDisconnected accountId: ${accountId}, workplatformId: ${workplatformId}, userId: ${userId}`\n      );\n    };\n    const onTokenExpiredCallBack = (userId) => {\n      console.log(`onTokenExpired userId: ${userId}`);\n    };\n\n    const onConnectionFailure = (reason, workplatformId, userId) => {\n      // if state not success\n      const state = sessionStorage.getItem(STORAGE_CONNECTION_STATE);\n      if (state === CONNECTION_SUCCESS) {\n        return;\n      }\n      if (reason === \"CONNECTION_ABANDONED\") {\n        sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_ABANDONED);\n      } else if (\n        reason === \"INCORRECT_ACCOUNT_TYPE\" ||\n        reason === \"INADEQUATE_PERMISSIONS\"\n      ) {\n        sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_ERROR);\n      } else {\n        sessionStorage.setItem(STORAGE_CONNECTION_STATE, CONNECTION_ERROR);\n      }\n\n      console.log(\n        `onConnectionFailure: ${reason}, ${workplatformId}, ${userId}`\n      );\n    };\n\n    const phylloConnect = window.PhylloConnect.initialize(config);\n\n    phylloConnect.on(\"exit\", onExitCallBack);\n    phylloConnect.on(\"tokenExpired\", onTokenExpiredCallBack);\n    phylloConnect.on(\"accountConnected\", onAccountConnectedCallBack);\n    phylloConnect.on(\"accountDisconnected\", onAccountDisconnectedCallBack);\n    phylloConnect.on(\"connectionFailure\", onConnectionFailure);\n\n    phylloConnect.open();\n  } catch (err) {\n    console.log(err);\n    setLoader(false);\n  }\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}